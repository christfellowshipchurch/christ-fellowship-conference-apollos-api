"use strict";

var _config = _interopRequireDefault(require("@apollosproject/config"));

var _dataSource = _interopRequireDefault(require("../data-source"));

var _testUtils = require("../../test-utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

_config.default.loadJs({
  ROCK: {
    API_URL: 'https://apollosrock.newspring.cc/api',
    API_TOKEN: 'some-rock-token',
    IMAGE_URL: 'https://apollosrock.newspring.cc/GetImage.ashx'
  },
  ROCK_MAPPINGS: {
    WEBSITE_CONTENT_CHANNEL_IDS: {
      TEST_SITE: [1]
    }
  }
});

const website = 'TEST_SITE';
const title = 'hello-there';
describe('Website Pages Content Item', () => {
  // Test the normalizeSlug method
  it('returns a lowercase string with no spaces', () => {
    const dataSource = new _dataSource.default();
    const testCases = [{
      pass: 'Hello There',
      expect: 'hellothere'
    }, {
      pass: 'Hello-There',
      expect: 'hello-there'
    }];
    testCases.forEach(n => {
      const normalize = dataSource.normalizeSlug(n.pass);
      expect(normalize).toEqual(n.expect);
    });
  }); // Test calls to the Content Channel Item Slugs table

  it('makes a call to ContentChannelItemSlugs where Slug is equal to the noramlized title passed in', async () => {
    const dataSource = new _dataSource.default();
    dataSource.get = jest.fn(() => Promise.resolve([{
      ContentChannelItemId: 1,
      Slug: title
    }]));
    const result = await dataSource.getContentChannelIdByTitle(title);
    expect(dataSource.get.mock.calls).toMatchSnapshot();
  });
  it('makes a call to ContentChannelItemSlugs where Slug is not found and returns null', async () => {
    const dataSource = new _dataSource.default();
    dataSource.get = jest.fn(() => Promise.resolve([]));
    const result = await dataSource.getContentChannelIdByTitle(title);
    expect(result).toEqual(null);
  }); // Test the possible return values when getting page content

  it('does not find slug for the title passed and returns null', async () => {
    const dataSource = new _dataSource.default();
    dataSource.getContentChannelIdByTitle = jest.fn(() => null);
    const result = await dataSource.getWebsitePageContentByTitle(website, title);
    expect(result).toEqual(null);
  });
  it('does not find a Content Channel Id for the website passed and returns null', async () => {
    const dataSource = new _dataSource.default();
    dataSource.get = jest.fn(() => Promise.resolve([{
      ContentChannelItemId: 1,
      Slug: title
    }]));
    const result = await dataSource.getWebsitePageContentByTitle('NOT_THE_RIGHT_WEBSITE', title);
    expect(result).toEqual(null);
  });
  it('gets a Website Page Content Item from passing in a website key and page title', async () => {
    const dataSource = new _dataSource.default();
    dataSource.get = (0, _testUtils.buildGetMock)([[{
      ContentChannelItemId: 1,
      Slug: title
    }], [{
      Id: 1,
      ContentChannelId: 10
    }]], dataSource);
    const result = await dataSource.getWebsitePageContentByTitle(website, title);
    expect(dataSource.get.mock.calls).toMatchSnapshot();
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9kYXRhL3dlYnNpdGUtcGFnZXMtY29udGVudC1pdGVtL19fdGVzdHNfXy9kYXRhLXNvdXJjZS50ZXN0cy5qcyJdLCJuYW1lcyI6WyJBcG9sbG9zQ29uZmlnIiwibG9hZEpzIiwiUk9DSyIsIkFQSV9VUkwiLCJBUElfVE9LRU4iLCJJTUFHRV9VUkwiLCJST0NLX01BUFBJTkdTIiwiV0VCU0lURV9DT05URU5UX0NIQU5ORUxfSURTIiwiVEVTVF9TSVRFIiwid2Vic2l0ZSIsInRpdGxlIiwiZGVzY3JpYmUiLCJpdCIsImRhdGFTb3VyY2UiLCJXZWJzaXRlUGFnZXNDb250ZW50SXRlbSIsInRlc3RDYXNlcyIsInBhc3MiLCJleHBlY3QiLCJmb3JFYWNoIiwibiIsIm5vcm1hbGl6ZSIsIm5vcm1hbGl6ZVNsdWciLCJ0b0VxdWFsIiwiZ2V0IiwiamVzdCIsImZuIiwiUHJvbWlzZSIsInJlc29sdmUiLCJDb250ZW50Q2hhbm5lbEl0ZW1JZCIsIlNsdWciLCJyZXN1bHQiLCJnZXRDb250ZW50Q2hhbm5lbElkQnlUaXRsZSIsIm1vY2siLCJjYWxscyIsInRvTWF0Y2hTbmFwc2hvdCIsImdldFdlYnNpdGVQYWdlQ29udGVudEJ5VGl0bGUiLCJJZCIsIkNvbnRlbnRDaGFubmVsSWQiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBQ0E7O0FBQ0E7Ozs7QUFFQUEsZ0JBQWNDLE1BQWQsQ0FBcUI7QUFDakJDLEVBQUFBLElBQUksRUFBRTtBQUNGQyxJQUFBQSxPQUFPLEVBQUUsc0NBRFA7QUFFRkMsSUFBQUEsU0FBUyxFQUFFLGlCQUZUO0FBR0ZDLElBQUFBLFNBQVMsRUFBRTtBQUhULEdBRFc7QUFNakJDLEVBQUFBLGFBQWEsRUFBRTtBQUNYQyxJQUFBQSwyQkFBMkIsRUFBRTtBQUN6QkMsTUFBQUEsU0FBUyxFQUFFLENBQUMsQ0FBRDtBQURjO0FBRGxCO0FBTkUsQ0FBckI7O0FBYUEsTUFBTUMsT0FBTyxHQUFHLFdBQWhCO0FBQ0EsTUFBTUMsS0FB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LENBQWQsQ0FBakI7QUFFQSxVQUFNb0IsTUFBTSxHQUFHLE1BQU1qQixVQUFVLENBQUNzQiw0QkFBWCxDQUF3Qyx1QkFBeEMsRUFBaUV6QixLQUFqRSxDQUFyQjtBQUVBTyxJQUFBQSxNQUFNLENBQUNhLE1BQUQsQ0FBTixDQUFlUixPQUFmLENBQXVCLElBQXZCO0FBQ0gsR0FSQyxDQUFGO0FBVUFWLEVBQUFBLEVBQUUsQ0FBQywrRUFBRCxFQUFrRixZQUFZO0FBQzVGLFVBQU1DLFVBQVUsR0FBRyxJQUFJQyxtQkFBSixFQUFuQjtBQUVBRCxJQUFBQSxVQUFVLENBQUNVLEdBQVgsR0FBaUIsNkJBQWEsQ0FDMUIsQ0FBQztBQUFFSyxNQUFBQSxvQkFBb0IsRUFBRSxDQUF4QjtBQUEyQkMsTUFBQUEsSUFBSSxFQUFFbkI7QUFBakMsS0FBRCxDQUQwQixFQUUxQixDQUFDO0FBQUUwQixNQUFBQSxFQUFFLEVBQUUsQ0FBTjtBQUFTQyxNQUFBQSxnQkFBZ0IsRUFBRTtBQUEzQixLQUFELENBRjBCLENBQWIsRUFHZHhCLFVBSGMsQ0FBakI7QUFLQSxVQUFNaUIsTUFBTSxHQUFHLE1BQU1qQixVQUFVLENBQUNzQiw0QkFBWCxDQUF3QzFCLE9BQXhDLEVBQWlEQyxLQUFqRCxDQUFyQjtBQUVBTyxJQUFBQSxNQUFNLENBQUNKLFVBQVUsQ0FBQ1UsR0FBWCxDQUFlUyxJQUFmLENBQW9CQyxLQUFyQixDQUFOLENBQWtDQyxlQUFsQztBQUNILEdBWEMsQ0FBRjtBQVlILENBckVPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQXBvbGxvc0NvbmZpZyBmcm9tICdAYXBvbGxvc3Byb2plY3QvY29uZmlnJztcbmltcG9ydCBXZWJzaXRlUGFnZXNDb250ZW50SXRlbSBmcm9tICcuLi9kYXRhLXNvdXJjZSc7XG5pbXBvcnQgeyBidWlsZEdldE1vY2sgfSBmcm9tICcuLi8uLi90ZXN0LXV0aWxzJ1xuXG5BcG9sbG9zQ29uZmlnLmxvYWRKcyh7XG4gICAgUk9DSzoge1xuICAgICAgICBBUElfVVJMOiAnaHR0cHM6Ly9hcG9sbG9zcm9jay5uZXdzcHJpbmcuY2MvYXBpJyxcbiAgICAgICAgQVBJX1RPS0VOOiAnc29tZS1yb2NrLXRva2VuJyxcbiAgICAgICAgSU1BR0VfVVJMOiAnaHR0cHM6Ly9hcG9sbG9zcm9jay5uZXdzcHJpbmcuY2MvR2V0SW1hZ2UuYXNoeCcsXG4gICAgfSxcbiAgICBST0NLX01BUFBJTkdTOiB7XG4gICAgICAgIFdFQlNJVEVfQ09OVEVOVF9DSEFOTkVMX0lEUzoge1xuICAgICAgICAgICAgVEVTVF9TSVRFOiBbMV1cbiAgICAgICAgfVxuICAgIH1cbn0pXG5cbmNvbnN0IHdlYnNpdGUgPSAnVEVTVF9TSVRFJ1xuY29uc3QgdGl0bGUgPSAnaGVsbG8tdGhlcmUnXG5cbmRlc2NyaWJlKCdXZWJzaXRlIFBhZ2VzIENvbnRlbnQgSXRlbScsICgpID0+IHtcbiAgICAvLyBUZXN0IHRoZSBub3JtYWxpemVTbHVnIG1ldGhvZFxuICAgIGl0KCdyZXR1cm5zIGEgbG93ZXJjYXNlIHN0cmluZyB3aXRoIG5vIHNwYWNlcycsICgpID0+IHtcbiAgICAgICAgY29uc3QgZGF0YVNvdXJjZSA9IG5ldyBXZWJzaXRlUGFnZXNDb250ZW50SXRlbSgpXG4gICAgICAgIGNvbnN0IHRlc3RDYXNlcyA9IFtcbiAgICAgICAgICAgIHsgcGFzczogJ0hlbGxvIFRoZXJlJywgZXhwZWN0OiAnaGVsbG90aGVyZScgfSxcbiAgICAgICAgICAgIHsgcGFzczogJ0hlbGxvLVRoZXJlJywgZXhwZWN0OiAnaGVsbG8tdGhlcmUnIH1cbiAgICAgICAgXVxuXG4gICAgICAgIHRlc3RDYXNlcy5mb3JFYWNoKG4gPT4ge1xuICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplID0gZGF0YVNvdXJjZS5ub3JtYWxpemVTbHVnKG4ucGFzcylcbiAgICAgICAgICAgIGV4cGVjdChub3JtYWxpemUpLnRvRXF1YWwobi5leHBlY3QpXG4gICAgICAgIH0pXG4gICAgfSlcblxuICAgIC8vIFRlc3QgY2FsbHMgdG8gdGhlIENvbnRlbnQgQ2hhbm5lbCBJdGVtIFNsdWdzIHRhYmxlXG4gICAgaXQoJ21ha2VzIGEgY2FsbCB0byBDb250ZW50Q2hhbm5lbEl0ZW1TbHVncyB3aGVyZSBTbHVnIGlzIGVxdWFsIHRvIHRoZSBub3JhbWxpemVkIHRpdGxlIHBhc3NlZCBpbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgZGF0YVNvdXJjZSA9IG5ldyBXZWJzaXRlUGFnZXNDb250ZW50SXRlbSgpXG5cbiAgICAgICAgZGF0YVNvdXJjZS5nZXQgPSBqZXN0LmZuKCgpID0+IFByb21pc2UucmVzb2x2ZShbeyBDb250ZW50Q2hhbm5lbEl0ZW1JZDogMSwgU2x1ZzogdGl0bGUgfV0pKVxuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRhdGFTb3VyY2UuZ2V0Q29udGVudENoYW5uZWxJZEJ5VGl0bGUodGl0bGUpXG5cbiAgICAgICAgZXhwZWN0KGRhdGFTb3VyY2UuZ2V0Lm1vY2suY2FsbHMpLnRvTWF0Y2hTbmFwc2hvdCgpXG4gICAgfSlcblxuICAgIGl0KCdtYWtlcyBhIGNhbGwgdG8gQ29udGVudENoYW5uZWxJdGVtU2x1Z3Mgd2hlcmUgU2x1ZyBpcyBub3QgZm91bmQgYW5kIHJldHVybnMgbnVsbCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgZGF0YVNvdXJjZSA9IG5ldyBXZWJzaXRlUGFnZXNDb250ZW50SXRlbSgpXG5cbiAgICAgICAgZGF0YVNvdXJjZS5nZXQgPSBqZXN0LmZuKCgpID0+IFByb21pc2UucmVzb2x2ZShbXSkpXG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGF0YVNvdXJjZS5nZXRDb250ZW50Q2hhbm5lbElkQnlUaXRsZSh0aXRsZSlcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG51bGwpXG4gICAgfSlcblxuICAgIC8vIFRlc3QgdGhlIHBvc3NpYmxlIHJldHVybiB2YWx1ZXMgd2hlbiBnZXR0aW5nIHBhZ2UgY29udGVudFxuICAgIGl0KCdkb2VzIG5vdCBmaW5kIHNsdWcgZm9yIHRoZSB0aXRsZSBwYXNzZWQgYW5kIHJldHVybnMgbnVsbCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgZGF0YVNvdXJjZSA9IG5ldyBXZWJzaXRlUGFnZXNDb250ZW50SXRlbSgpXG5cbiAgICAgICAgZGF0YVNvdXJjZS5nZXRDb250ZW50Q2hhbm5lbElkQnlUaXRsZSA9IGplc3QuZm4oKCkgPT4gbnVsbClcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYXRhU291cmNlLmdldFdlYnNpdGVQYWdlQ29udGVudEJ5VGl0bGUod2Vic2l0ZSwgdGl0bGUpXG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChudWxsKVxuICAgIH0pXG5cbiAgICBpdCgnZG9lcyBub3QgZmluZCBhIENvbnRlbnQgQ2hhbm5lbCBJZCBmb3IgdGhlIHdlYnNpdGUgcGFzc2VkIGFuZCByZXR1cm5zIG51bGwnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGRhdGFTb3VyY2UgPSBuZXcgV2Vic2l0ZVBhZ2VzQ29udGVudEl0ZW0oKVxuXG4gICAgICAgIGRhdGFTb3VyY2UuZ2V0ID0gamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUoW3sgQ29udGVudENoYW5uZWxJdGVtSWQ6IDEsIFNsdWc6IHRpdGxlIH1dKSlcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYXRhU291cmNlLmdldFdlYnNpdGVQYWdlQ29udGVudEJ5VGl0bGUoJ05PVF9USEVfUklHSFRfV0VCU0lURScsIHRpdGxlKVxuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobnVsbClcbiAgICB9KVxuXG4gICAgaXQoJ2dldHMgYSBXZWJzaXRlIFBhZ2UgQ29udGVudCBJdGVtIGZyb20gcGFzc2luZyBpbiBhIHdlYnNpdGUga2V5IGFuZCBwYWdlIHRpdGxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBkYXRhU291cmNlID0gbmV3IFdlYnNpdGVQYWdlc0NvbnRlbnRJdGVtKClcblxuICAgICAgICBkYXRhU291cmNlLmdldCA9IGJ1aWxkR2V0TW9jayhbXG4gICAgICAgICAgICBbeyBDb250ZW50Q2hhbm5lbEl0ZW1JZDogMSwgU2x1ZzogdGl0bGUgfV0sXG4gICAgICAgICAgICBbeyBJZDogMSwgQ29udGVudENoYW5uZWxJZDogMTAgfV1cbiAgICAgICAgXSwgZGF0YVNvdXJjZSlcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYXRhU291cmNlLmdldFdlYnNpdGVQYWdlQ29udGVudEJ5VGl0bGUod2Vic2l0ZSwgdGl0bGUpXG5cbiAgICAgICAgZXhwZWN0KGRhdGFTb3VyY2UuZ2V0Lm1vY2suY2FsbHMpLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICAgIH0pXG59KTsiXX0=